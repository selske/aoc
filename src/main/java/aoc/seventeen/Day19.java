package aoc.seventeen;

import java.io.BufferedReader;
import java.io.StringReader;
import java.time.Duration;
import java.time.Instant;

public class Day19 {

    private static final String INPUT = // " | \n" + " | +--+ \n" + " A | C \n" + " F---|--|-E---+
                                        // \n" + " | | | D \n" + " +B-+ +--+ \n" + "";
                    "" //
                                    + "                                                                                                                                                                   |                                     \n"
                                    + "   +-------+                   +---------------------+                     +-----------+                         +---------------------------------------+         |                                 +-+ \n"
                                    + "   |       |                   |                     |                     |           |                         |                                       |         |                                 | | \n"
                                    + "   |       |   +---------------|---------------------|-----------------------------------------------------------------------------+           +---------------------+                               | | \n"
                                    + "   |       |   |               |                     |                     |           |                         |                 |           |         |         | |                               | | \n"
                                    + "   |   +-----------------+ +---+     +-----------+   |                     |           |                         |   +-------------+           |         |         | |                               | | \n"
                                    + "   |   |   |   |         | |         |           |   |                     |           |                         |   |                         |         |         | |                               | | \n"
                                    + "   |   |   | +-|---------|-----------|---------+ +-----------+             |           +-----------------------------|-------+                 |         |         | |                               | | \n"
                                    + "   |   |   | | |         | |         |         |     |       |             |                                     |   |       |                 |         |         | |                               | | \n"
                                    + "   |   |   | | |         +---+       |     +-------------------------------|-------------------------------------|-----------------------------+         |         | |                 +-------------+ | \n"
                                    + "   |   |   | | |           | |       |     |   |     |       |             |                                     |   |       |                           |         | |                 |               | \n"
                                    + "   |   |   | | |           | |     +-|-----|---|---------------------------|-----------+                         |   |       |                           |         | |                 |               | \n"
                                    + "   |   |   | | |           | |     | |     |   |     |       |             |           |                         |   |       |                           |         | |                 |               | \n"
                                    + "   |   |   | | |           | |     | |     |   +-----|-----+ |             |           |                 +-------|---|-------+                           |         | |                 |               | \n"
                                    + "   |   |   | | |           | |     | |     |         |     | |             |           |                 |       |   |                                   |         | |                 |               | \n"
                                    + "   |   |   | | |           | |     | |     |         |     +-|-------------------------+       +---------|-------|---------------------------------------|---------|-------------------|-+     +-+     | \n"
                                    + "   |   |   | | |           | |     | |     |         |       |             |                   |         |       |   |                                   |         | |                 | |     | |     | \n"
                                    + "   |   |   | +-|-------------|-----|-----------------------+ |             |                   |         |       |   |                                   |         | |                 | |     +-|-+   | \n"
                                    + "   |   |   |   |           | |     | |     |         |     | |             |                   |         |       |   |                                   |         | |                 | |       | |   | \n"
                                    + "   |   |   |   |           | |     | |     |   +-----|-------|-------------|-------------------|---------+       |   |                     +-------------|---------|I|-------------------------+ | |   | \n"
                                    + "   |   |   |   |           | |     | |     |   |     |     | |             |                   |                 |   |                     |             |         | |                 | |     | | |   | \n"
                                    + "   |   |   |   |           | |     | |     |   |     |     | |             |                   | +-----------+   |   |               +-----|------C------------------------------------+ |     | | |   | \n"
                                    + "   |   |   |   |           | |     | |     |   |     |     | |             |                   | |           |   |   |               |     |             |         | |                   |     | | |   | \n"
                                    + "   |   |   |   |   +-------|---------|-----|---------------|-|-------------|---------+         | |           |   +---|-------+       |     |   +---------|-----+   | |               +-+ |     | | |   | \n"
                                    + "   |   |   |   |   |       | |     | |     |   |     |     | |             |         |         | |           |       |       |       |     |   |         |     |   | |               | | |     | | |   | \n"
                                    + "   |   |   |   |   |       +-------|-|-----|---|-----|---------------------|---------|---------|-------------|---+   |       |       |     |   |         |     |   | |               | | |   +---+ |   | \n"
                                    + "   |   |   |   |   |         |     | |     |   |     |     | |             |         |         | |           |   |   |       |       |     |   |         |     |   | |               | | |   | |   |   | \n"
                                    + "   |   |   |   +-------------------|-|---------------------+ |         +-----------------------|-----------------|---|---------------------|-----------------------------------------|-|-------|-+ |   | \n"
                                    + "   |   |   |       |         |     | |     |   |     |       |         |   |         |         | |           |   |   |       |       |     |   |         |     |   | |               | | |   | | | |   | \n"
                                    + "   |   |   |       |         |     | |     |   |     |       |         |   |         |         | |           |   |   +---------------|---------|N--------------|-----+               | | |   | | | |   | \n"
                                    + "   |   |   |       |         |     | |     |   |     |       |         |   |         |         | |           |   |           |       |     |   |         |     |   |                 | | |   | | | |   | \n"
                                    + "   |   |   |   +-----------+ |     | |     +---|-----|-----------------|---+         |         | |         +-|---|-------------------|---------|---------|-----|---|-----------------|-|-|---+ | | |   | \n"
                                    + "   |   |   |   |   |       | |     | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   | \n"
                                    + "   |   |   |   |   |       | |     | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   | \n"
                                    + "   |   |   |   |   |       | |     | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   | \n"
                                    + "   |   |   |   |   +-------|-|---+ | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   | \n"
                                    + "   |   |   |   |           | |   | | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   | \n"
                                    + "   |   |   |   |           | +-+ | | |         |     |       |         |   +-------------------|---------+ | |   |           |       |     |   |         |     |   |                 | | |     | | |   | \n"
                                    + "   |   |   |   |           |   | | | |         |     |       |         |   |         |         | |       | | |   |           |       |     |   |         |     |   |                 | | |     | | |   | \n"
                                    + "   +---|-------|---------------|---|-|-----------+   |       |         |   |         |         | |       | | |   |           |       |     |   |         |     |   |                 | | |     | | |   | \n"
                                    + "       |   |   |           |   | | | |         | |   |       |         |   |         |         | |       | | |   |           |       |     |   |         |     |   |                 | | |     | | |   | \n"
                                    + "       |   |   |           |   +---|-+         | |   |       |         |   |   +-+   |         | |       +-+ |   +-------------------------|-----------------------|-----------------|---+     | | |   | \n"
                                    + "       |   |   |           |     | |           | |   |       |         |   |   | |   |         | |           |               |       |     |   |         |     |   |                 | |       | | |   | \n"
                                    + "       |   |   |           |     | |           | |   |       |         |   |   | |   | +-------|-------------|---------------|-------------|-------------------|-------------------+ | |       | | |   | \n"
                                    + "       |   |   |           |     | |           | |   |       |         |   |   | |   | |       | |           |               |       |     |   |         |     |   |               | | |       | | |   | \n"
                                    + "       |   |   |   +-------|-----|-------+     | |   |       |         |   |   | |   | |       | |           |               |       |     |   |         |     |   |               | | |       | | +-+ | \n"
                                    + "       |   |   |   |       |     | |     |     | |   |       |         |   |   | |   | |       | |           |               |       |     |   |         |     |   |               | | |       | |   | | \n"
                                    + "       |   |   |   |       |     | |     |     | |   |       +---------|---------------|---------|-----------|-----------------------------|-------------|---------|---------------|-|-----------|---+ | \n"
                                    + "       |   |   |   |       |     | |     |     | |   |                 |   |   | |   | |       | |           |               |       |     |   |         |     |   |               | | |       | |     | \n"
                                    + "       |   |   |   |       +-----|-|-----|-----|-----|-------+         |   |   | |   | |       | |       +-----------------------+   |     |   |         |     |   |               | | |     +-------+ | \n"
                                    + "       |   |   |   |             | |     |     | |   |       |         |   |   | |   | |       | |       |   |               |   |   |     |   |         |     |   |               | | |     | | |   | | \n"
                                    + "       |   |   |   |             | |     |     | |   |       |         |   |   | |   | | +-----------------------------------|---|-------------|---------|-----|-------------------------------|-+ +-+ | \n"
                                    + "       |   |   |   |             | |     |     | |   |       |         |   |   | |   | | |     | |       |   |               O   |   |     |   |         |     |   |               | | |     | |   |   | \n"
                                    + "       |   |   |   |     +-------|-------|-----------|-------|-------------|-----|---|-|-------|---------|---|-------------------|-----------------------------|-----------------+ | | |     | |   |   | \n"
                                    + "       |   |   |   |     |       | |     |     | |   |       |         |   |   | |   | | |     | |       |   |               |   |   |     |   |         |     |   |             | | | |     | |   |   | \n"
                                    + "       |   |   |   |     |       | |     |     | |   |       |         |   |   | |   | | |     | |       |   |       +-+     |   |   |     |   |         |     |   |             | | | |     | |   |   | \n"
                                    + "       |   |   |   |     |       | |     |     | |   |       |         |   |   | |   | | |     | |       |   |       | |     |   |   |     |   |         |     |   |             | | | |     | |   |   | \n"
                                    + "       |   |   |   |     |   +---|-|-----|-----|-|--R|-------|-------------|---|---------------|-------------|-------|-|---------|---------|---|---------|---------|-----------------|-|-----------|-+ | \n"
                                    + "       |   |   |   |     |   |   | |     |     | |   |       |         |   |   | |   | | |     | |       |   |       | |     |   |   |     |   |         |     |   |             | | | |     | |   | | | \n"
                                    + "       |   |   |   |   +-----+   | |     |     | |   |       |         |   |   | |   | | |     | |       +---------------------------|-------------------|-----------------------+ | | |     | |   | | | \n"
                                    + "       |   |   |   |   | |       | |     |     | |   |       |         |   |   | |   | | |     | |           |       | |     |   |   |     |   |         |     |   |               | | |     | |   | | | \n"
                                    + "       |   |   |   |   | |       | |     |     | |   |     +-----------|-------|-|-------|-------|-----------|-------|-------|-------------|---------------------------------+     | +-------+ |   | | | \n"
                                    + "       |   |   |   |   | |       | |     |     | |   |     | |         |   |   | |   | | |     | |           |       | |     |   |   |     |   |         |     |   |         |     |   |       |   | | | \n"
                                    + "       |   |   |   |   | |       | +-----|-------|---------|-----------|---|-----|-------------|-|---------------------------------+ |     |   |         |     |   |         |   +-----|-------|---+ | | \n"
                                    + "       |   |   |   |   | |       |       |     | |   |     | |         |   |   | |   | | |     | |           |       | |     |   | | |     |   |         |     |   |         |   | |   |       |     | | \n"
                                    + "       |   |   | +---------------|-------|S------|---|-----+ |         |   |   | |   | | |     | |   +-------|---------|---------|---------|---|-------+ +---------|-------------+ |   |       |     | | \n"
                                    + "       |   |   | | |   | |       |       |     | |   |       |         |   |   | |   | | |     | |   |       |       | |     |   | | |     |   |       |       |   |         |     |   |       |     | | \n"
                                    + "       |   |   | | |   | |   +-----------------|-----|-------|-------------|-----|---|---|-----|-|-----------|-------|-|-----|---|-|-+     |   |       |       |   |         |     |   |       |     | | \n"
                                    + "       |   |   | | |   | |   |   |       |     | |   |       |         |   |   | |   | | |     | |   |       |       | |     |   | |       |   |       |       |   |         |     |   |       |     | | \n"
                                    + "       |   |   | | +-------------|-------------|-|---|-------|-------------|---------|-------------------------------|-------|-------------|-------+   |       |   |         |     |   |       |     | | \n"
                                    + "       |   |   | |     | |   |   |       |     | |   |       |         |   |   | |   | | |     | |   |       |       | |     |   | |       |   |   |   |       |   |         |     |   |       |     | | \n"
                                    + "       | +-|---|-|-----|-|---------------|-------|-----------|-------------------|-------------|-|---------------------|-----|---|-|-------|-------|---|---------+ |         |     |   |       |     | | \n"
                                    + "       | | |   | |     | |   |   |       |     | |   |       |         |   |   | |   | | |     | |   |       |       | |     |   | |       |   |   |   |       | | |         |     |   |       |     | | \n"
                                    + "       | | |   | |     | |   | +---------|-----|-|-------+   |         |   |   | |   | | |     | |   |       |       | |     |   +-------------|-----------------|-----+     |     |   |       |     | | \n"
                                    + "       | | |   | |     | |   | | |       |     | |   |   |   |         |   |   | |   | | |     | |   |       |       | |     |     |       |   |   |   |       | | |   |     |     |   |       |     | | \n"
                                    + "       | | |   | |     | |   | | |       |     | |   |   |   |       +-|---|---|---------|-------|-------------------------------------------------|---|-----+ | | |   |     |     |   |       |     | | \n"
                                    + "       | | |   | |     | |   | | |       |     | |   |   |   |       | |   |   | |   | | |     | |   |       |       | |     |     |       |   |   |   |     | | | |   |     |     |   |       |     | | \n"
                                    + "       | | |   | |     | |   | | |       |     | |   |   |   |       | |   |   | |   | | |     | |   |       |     +-|-|-----------|-------------------+     | | | |   |     |     |   |       |     | | \n"
                                    + "       | | |   | |     | |   | | |       |     | |   |   |   |       | |   |   | |   | | |     | |   |       |     | | |     |     |       |   |   |         | | | |   |     |     |   |       |     | | \n"
                                    + "       | | |   | |     | |   | | +---+   |     | |   |   |   |       | +-+ |   | |   | +-+ +---|-|---|-------|-----|-|-------------|-----------|---|---------|-|-------|-----|---------|-------------|-+ \n"
                                    + "       | | |   | |     | |   | |     |   |     | |   |   |   |       |   | |   | |   |     |   | |   |       |     | | |     |     |       |   |   |         | | | |   |     |     |   |       |     |   \n"
                                    + "       | | |   | |     | |   | |     |   |     | |   |   |   |       |   | |   | |   |     |   | |   |       |     | | |     |     |       |   |   |         | | | |   |     | +-------|-------|-----+   \n"
                                    + "       | | |   | |     | |   | |     |   |     | |   |   |   |       |   | |   | |   |     |   | |   |       |     | | |     |     |       |   |   |         | | | |   |     | |   |   |       |         \n"
                                    + "   +---|-|-|---|-------|-|-----|---------|-----|-----|---|---+       |   | |   | |   |     | +-|-|---|-------|-----|---|-----------|---+   |   |   |         | | | |   |     | |   |   |       |         \n"
                                    + "   |   | | |   | |     | |   | |     |   |     | |   |   |           |   | |   | |   |     | | | |   |       |     | | |     |     |   |   |   |   |         | | | |   |     | |   |   |       |         \n"
                                    + "   |   | +-------|-----|-|-----|-----|---|-----------|-------------------|-|---|-----|-----|-+ | |   |       |     | | |     |     +-----------|---|-------+ | | | |   |     | |   |   |       |         \n"
                                    + "   |   |   |   | |     | |   | |     |   |     | |   |   |           |   | |   | |   |     |   | |   |       |     | | |     |         |   |   |   |       | | | | |   |     | |   |   |       |         \n"
                                    + "   | +-+   |   | |     | |   | |     |   |     | |   |   |           |   | |   | |   |     |   | |   |       |     | | |     |         |   |   |   |       | | | | |   |     | |   |   |       |         \n"
                                    + "   | |     |   | |     | |   | |     |   |     | |   |   |           |   | |   | |   |     |   | |   |       |     | | |     |         |   |   |   |       | | | | |   |     | |   |   |       |         \n"
                                    + "   | |   +-----|-------|-|---|-|-+   |   +-----|---------------------|-----|---|-----|-----|---|-|---|-------------------------+       |   |   |   +-------|---|-|-|---|-----+ |   |   |       |         \n"
                                    + "   | |   | |   | |     | |   | | |   |         | |   |   |           |   | |   | |   |     |   | |   |       |     | | |     | |       |   |   |           | | | | |   |       |   |   |       |         \n"
                                    + "   | |   | |   | |     | |   | | +-------------------|---------------------------|---------+ +---|-----------+     +-|-+     | +-------|-+ |   |           | | | | |   |       |   |   |       |         \n"
                                    + "   | |   | |   | |     | |   | |     |         | |   |   |           |   | |   | |   |       | | |   |               |       |         | | |   |           | | | | |   |       |   |   |       |         \n"
                                    + "   | |   | |   | |     | |   | |     |         | |   |   +---------------|---------------------------------------------+     |         | | |   |           | | | | |   |       |   |   |       |         \n"
                                    + "   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |       | | |   |               | |     |         | | |   |           | | | | |   |       |   |   |       |         \n"
                                    + "   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |       | | |   |               | |     |         | | |   |           | | | | |   |       |   |   |       |         \n"
                                    + "   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |       | | |   |               | |     |         | | |   |           | | | | |   |       |   |   |       |         \n"
                                    + "   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |   +---|---|---|-----------------|-----|-----------|-|---------------|-|---+ |   |       |   |   |     +-|-------+ \n"
                                    + "   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |   |   | | |   |               | |     |         | | |   |           | | |   |   |       |   |   |     | |       | \n"
                                    + " +---|-----|---|-|-----|-|-----|-----|--U--------|---|-----------------------+ | |   |   |   | | |   |               | |     |         | | |   |           | | |   |   |       |   |   |     | |       | \n"
                                    + " | | |   | |   | |     | |   | |     |         | |   |               |   | | | | |   |   |   | | |   |               | |     |         | | |   |           | | |   |   |       |   |   |     | |       | \n"
                                    + " | | |   | |   | |     | |   | |     |         | |   |               |   | | | +-----------+ | | |   |               | |     |         | | |   |           | | |   |   +-----+ |   +---|-+   | |       | \n"
                                    + " | | |   | |   | |     | |   | |     |         | |   |               |   | | |   |   |   | | | | |   |               | |     |         | | |   |           | | |   |         | |       | |   | |       | \n"
                                    + " | | |   | |   | |     | |   | |     |         | |   |         +-----|---|-|---------|---|-|-|-+ |   |               | |     |         | | |   |           | | |   |       +---+       | |   | |       | \n"
                                    + " | | |   | |   | |     | |   | |     |         | |   |         |     |   | | |   |   |   | | |   |   |               | |     |         | | |   |           | | |   |       | |         | |   | |       | \n"
                                    + " | | |   | |   | |     | |   | |     |         | |   |         |     |   | | |   |   |   | | |   | +-----------------+ |     |         | | |   |           | | |   |       | |         | |   | |       | \n"
                                    + " | | |   | |   | |     | |   | |     |         | |   |         |     |   | | |   |   |   | | |   | | |                 |     |         | | |   |           | | |   |       | |         | |   | |       | \n"
                                    + " | | |   | |   | | +---|-|D--|-------+ +---------|---|---------|-----|-----|---------|---|-|---+ | | |                 |     |         | +-|---------------|---------------|-|---------|-|---|-------+ | \n"
                                    + " | | |   | |   | | |   | |   | |       |       | |   |         |     |   | | |   |   |   | | | | | | |                 |     |         |   |   |           | | |   |       | |         | |   | |     | | \n"
                                    + " | | |   | |   | | |   | |   | |       |       | |   |         |     |   | | |   |   | +---|---|-|-|-------------------|-----------------------+           | | |   |       | |         | |   | |     | | \n"
                                    + " | | |   | |   | | |   | |   | |       |       | |   |         |     |   | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |       | |         | |   | |     | | \n"
                                    + " | | |   | |   | | +---|-------|---+   +-------|-|---|---------|-----+   | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |       | |         | |   | |     | | \n"
                                    + " | | |   | |   | |     | |   | |   |           | |   |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |       | |         | |   | |     | | \n"
                                    + " | | +---|-----|---+   | |   | |   |           +---------------------------------------|-|-|-|-|-|---|-----------------|-----|-------------|---------------------------+   | |   +-----|-----|-------+ | \n"
                                    + " | |     | |   | | |   | |   | |   |             |   |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   |     | |   | |       | \n"
                                    + " | |     | | +---|-+   | |   | |   |             |   |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   |     | |   | |       | \n"
                                    + " | |     | | | | |     | |   | |   |             |   |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   |     | |   | |       | \n"
                                    + " | |     | | | | |     | |   | |   |             +-------------|---------|---|-------|---|-|-|---|---|-----------------|-----|---------|-----------------------|-------|---|-----|-------|---|-+       | \n"
                                    + " | |     | | | | |     | |   | |   |                 |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   |     | |   |         | \n"
                                    + " | |     | | | | | +---|-|---------|-----------------|---------|---------|-|-----+   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   +-----------|-----+   | \n"
                                    + " | |     | | | | | |   | |   | |   |                 |         |         | | |       | | | | | | | | |                 |     |         |   |               | | |   |   |   | |         | |   |     |   | \n"
                                    + " | |     | | | | | |   | |   | |   |                 |         |         | | |       +-|-|---|-|-----+                 |     |         |   |   +-----------|-------|---|---|-+ +-------|-----|-----|-+ | \n"
                                    + " | |     | | | | | |   | |   | |   |                 |         |         | | |         | | | | | | |                   |     |         |   |   |           | | |   |   |   |   |       | |   |     | | | \n"
                                    + " | |     | | | | | |   | |   | |   |                 |   +---------------|---|---------|-|-----|-|-|-------------------|---------------|---|---------------|-|-|---|-------|-----+     | |   |     | | | \n"
                                    + " | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | | | | |                   |     |         |   |   |           | | |   |   |   |   | |     | |   |     | | | \n"
                                    + " | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | | +-|-|-------------------|-----|---------------+ +-----------|-|---------|-------|---------|---|-----|-+ | \n"
                                    + " | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | |   | |                   |     |         |   | |             | | |   |   |   |   | |     | |   |     |   | \n"
                                    + " | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       +-----------+     |         |   | |             | | |   |   |   |   | |     | |   |     |   | \n"
                                    + " | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |   | |             | | |   |   |   |   | |     | |   |     |   | \n"
                                    + " | |     | | | +---------|---|-|---|---------+       |   |     |         | | |   +-------|-|---------------|---------------------------|---|-----------------|-----+   |   |   | |     | |   |     |   | \n"
                                    + " | |     | | |   | |   | |   | |   |         |       |   |     |         | | |   |     | | | |   | |       |                 |         |   | |             | | |       |   |   | |     | |   |     |   | \n"
                                    + " | +-------+ |   | |   | |   | |   |         +---------------------------|-------------|---|---------------|---------------------------------------------------|---------------|-|-----------------|-+ | \n"
                                    + " |       |   |   | |   | |   | |   |                 |   |     |         | | |   |     | | | |   | |       |                 |         |   | |             | | |       |   |   | |     | |   |     | | | \n"
                                    + " |       |   |   | |   | |   | |   |                 |   |     |         | | |   +-----|-|---|-----------------------------------------|-------------------|-|-------------------+     | |   |     | | | \n"
                                    + " |       |   |   | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |   | |             | | |       |   |   |       | |   |     | | | \n"
                                    + " |       |   |   | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |   +-|---------------|-------------|---|-------|-|---|-----|---+ \n"
                                    + " |       |   |   | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |     |             | | |       |   |   |       | |   |     | |   \n"
                                    + " |       | +-------|---|-|---------------------------|---|---------------|---|---------|-----------|-------------------------|---------|-----|-+           | | |       |   |   |       | |   |     | |   \n"
                                    + " |       | | |   | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |     | |           | | |       |   |   |       | |   |     | |   \n"
                                    + " |       | | +---|-----------|-------------+         |   |     |         | | |         | | | |   | |       |                 |         |     | +-------------|-------------|---------+ | |   |     | |   \n"
                                    + " |       | |     | |   | |   | |   |       |         |   |     |         | | |         | | | |   | |       |                 |         |     |             | | |       |   |   |     | | |   |     | |   \n"
                                    + " |       | |     | |   | |   | |   |       |         |   |     |         | | |         | | | |   | |       |                 |         |     |       +-----|---+       |   |   |     | | |   |     | |   \n"
                                    + " |       | |     | |   | |   | |   |       |         |   |     |         | | |         | | | |   | |       |                 |         |     |       |     | |         |   |   |     | | |   |     | |   \n"
                                    + " |       | |     | |   +-|-----|---|---------------------|---------------|-|-|---------|---|-|---|---------------------------|-----------------------|-----------------|-------------|-|-+   |     | |   \n"
                                    + " |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   | |       |                 |         |     |       |     | |         |   |   |     | |     |     | |   \n"
                                    + " |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   | +-----------------------------------|-+   |       |     | |         |   |   |     | |     |     | |   \n"
                                    + " |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |   \n"
                                    + " |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |   \n"
                                    + " |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |   \n"
                                    + " |       | |     | |     |   | | +---------+         |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |   \n"
                                    + " |       | |     | |     |   | | | |                 |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |   \n"
                                    + " |       | |     | |     |   | | | |       +---------------------------------|---------------+   |         | +---------------|-----------------------|-----|-|---------|---------------|-----------|-|-+ \n"
                                    + " |       | |     | |     |   | | | |       |         |   |     |         | | |         | | |     |         | |               |         | |   |       |     | |         |   |   |     | |     |     | | | \n"
                                    + " | +-------------|-|-----------------------+         |   +-----|---------|-----------------|-----|-+       | |               |         | |   |       |     | |         |   |   |     | |     |     | | | \n"
                                    + " | |     | |     | |     |   | | | |                 |         |         | | |         | | |     | |       | |               |         | |   |       |     | |         |   |   |     | |     |     | | | \n"
                                    + " | |     | |     | |     |   | | | |                 |         |         | | |         | | |     | |       | |               |         | |   |       |     | |         |   |   |     | |     |     | | | \n"
                                    + " | |     | |     | |     |   | | | |                 |         |         | | |         | | |     | |       | |               |         | |   |       |     | |         |   |   |     | |     |     | | | \n"
                                    + " | |     | |     | |     |   | | | |                 |         |         | | |         | | | +---|-|-------|-|-------------------------|-----|-------------|-----------|---|-----+   | |     |     | | | \n"
                                    + " | |     | |     | |     |   | | | |                 |         |         | | |         | | | |   | |       | |               |         | |   |       |     | |         |   |   | |   | |     |     | | | \n"
                                    + " | |     | |     | |     |   | | | |                 |   +-----------------|-----------|-------------------|-|---------------|---------|-|-----------------|-|---------|---|-----+   | |     |     | | | \n"
                                    + " | |     | |     | |     |   | | | |                 |   |     |         | | |         | | | |   | |       | |               |         | |   |       |     | |         |   |   |     | |     |     | | | \n"
                                    + " | |     | |     | |     |   | | | |                 |   +-----|-----------|-|---------|---|-----|-+       | |       +-------|---------|---------------------------------------|-----|---+   |     | | | \n"
                                    + " | |     | |     | |     |   | | | |                 |         |         | | |         | | | |   |         | |       |       |         | |   |       |     | |         |   |   |     | | |   |     | | | \n"
                                    + " | +-----|-------+ |     +---|---+ |                 |         |         | | |         | | | |   |         | |       |     +-|---------------|-------|-------------------------|-----|-|---+ |     | | | \n"
                                    + " |       | |       |         | |   |                 |         |         | | |         | | | |   |         | |       |     | |         | |   |       |     | |         |   |   |     | | | | |     | | | \n"
                                    + " |   +-----|-----------------|-|---|-----------------|---------|---------|-------------|---|---------------|-|-------|-----|-----------|-----|-------------|-----------|---|-----+   | | +-----+   | +-+ \n"
                                    + " |   |   | |       |         | |   |                 |         |         | | |         | | | |   |         | |       |     | |         | |   |       |     | |         |   |   | |   | |   | | |   |     \n"
                                    + " |   |   | +-------|-+     +-|-+   |                 |         |         | | |         | | | |   |         | |       |     | |         | |   |       |     | |         |   | +-+ |   | |   | | |   |     \n"
                                    + " |   |   |         | |     | |     |                 |         |         | | |         | | | |   |         | |       |     | |         | |   |       |     | |         |   | |   |   | |   | | |   |     \n"
                                    + " |   |   |         +-|-----------------------------------------|-------------|-+       +-|-------------+   | |       |     | |         | |   +-------------|-----------|-----|---|---|-|---|-|-|---|---+ \n"
                                    + " |   |   |           |     | |     |                 |         |         | | | |         | | |   |     |   | |       |     | |         | |           |     | |         |   | |   |   | |   | | |   |   | \n"
                                    + " | +-------------------------|-----------------------|---------|-----------|-|-|-----------|-+   |     |   | | +-----------|-|-----------------------------------------|---|-|---|---|-|---|-|-|---+   | \n"
                                    + " | | |   |           |     | |     |                 |         |         | | | |         | |     |     |   | | |     |     | |         | |           |     | |         |   | |   |   | |   | | |       | \n"
                                    + " | | |   | +---------|-----|-|---+ |                 |         |         | | +-----------|-------------|-------|-------------|---------|-|---------+ |     | |         |   | |   |   | |   | | |       | \n"
                                    + " | | |   | |         |     | |   | |                 |         |         | |   |         | |     |     |   | | |     |     | |         | |         | |     | |         |   | |   |   | |   | | |       | \n"
                                    + " | | +---------------------|-----|-------------------|---------|-----------|---------------|-----|---------|---------------+ |         | |         +-----+ | |         |   | |   |   | +-----|-----+   | \n"
                                    + " | |     | |         |     | |   | |                 |         |         | |   |         | |     |     |   | | |     |       |         | |           |   | | |         |   | |   |   |     | | |   |   | \n"
                                    + " +-+     | +---------------+ +---------------------------------------------|---+         | |     |     |   | | |     |       |         | |   +-------|---------------------------+ +-------+ | +-+ |   | \n"
                                    + "         |           |           | |                 |         |         | |             | |     |     |   | | |     |       |         | |   |       |   | | |         |   | |     | |       |   | |   | \n"
                                    + "   +-----+ +---------------------------------------------------|-----------+             | |     +-------------------|-------|---------+ |   |       |   | | |         |   | +-------|---+   |   | |   | \n"
                                    + "   |       |         |           | |                 |         |         |               | |           |   | | |     |       |           |   |       |   | | |         |   |       | |   |   |   | |   | \n"
                                    + "   |       +-----+   +-----------|-|-----------------|-------------------+               | |       +---|-------------+     +-----------------|---------------|-------------------+ | |   +-+ |   +-+   | \n"
                                    + "   |             |               | |                 |         |                         | |       |   |   | | |           | |           |   |       |   | | |         |   |     | | |     | |         | \n"
                                    + " +-+ +-----------|---------------|-------------------+         |                         | |   +---|---|-------------------|-|-----------|---|-----------|-+ |         |   |     | | |     | |       +-+ \n"
                                    + " |   |           |               | |                           |                         | |   |   |   |   | | |           | |           |   |       |   |   |         |   |     | | |     | |       |   \n"
                                    + " | +-------------|-----------------|-----------------------------------------------------|-|---|---|-------|-|-------------|---------------------------------|---------|---|---------------|-+       |   \n"
                                    + " | | |           |               | |                           |                         | |   |   |   |   | | |           | |           |   |       |   |   |         |   |     | | |     |         |   \n"
                                    + " | | +-----------|-----------------|---------------------------|-----------------------------------|---|---|-|-|-------------------+     |   |       |   |   |         |   |   +-+ | |     |         |   \n"
                                    + " | |             |               | |                           |                         | |   |   |   |   | | |           | |     |     |   |       |   |   |         |   |   |   | |     |         |   \n"
                                    + " | |             |               | |                           |                         | +-------|---|---|-+ |           +-+     |     | +---------|---|---+         |   +-------+ |     |         |   \n"
                                    + " | |             |               | |                           |                         |     |   |   |   |   |                   |     | | |       |   |             |       |     |     |         |   \n"
                                    + " | |             |               +-------------------------------------------------------------|---|-------|-----------------------|-----+ +-+       |   |             |       +-----------+         |   \n"
                                    + " | |             |                 |                           |                         |     |   |   |   |   |                   |                 |   |             |             |               |   \n"
                                    + " +-|-------------------------------------+                     |                         +-----+   +---+   +---+                   +---------------+ +-+ +-------------|---------------------------+ |   \n"
                                    + "   |             |                 |     |                     |                                                                                   |   |               |             |             | |   \n"
                                    + "   |             |   +-------------+     +---+                 +---------------------------------------------------------------------------------------|---------------|-------------|-------------+ |   \n"
                                    + "   |             |   |                       |                                                                                                     |   |               |             |               |   \n"
                                    + "   +-----------------------------------------------------------------------------------------------------------------------------------------------+ K-+               +-------------+               |   \n"
                                    + "                 |   |                       |                                                                                                                                                       |   \n"
                                    + "                 +---+                       +-------------------------------------------------------------------------------------------------------------------------------------------------------+   \n"
                                    + "                                                                                                                                                                                                         ";

    private static enum Direction {
        UP, DOWN, LEFT, RIGHT;

        public boolean horizontal() {
            return this.equals(LEFT) || this.equals(RIGHT);
        }

        public boolean vertical() {
            return this.equals(UP) || this.equals(DOWN);
        }
    }

    public static void main(final String[] args) {
        Instant before = Instant.now();

        char[][] input = new BufferedReader(new StringReader(INPUT)).lines() //
                        .map(String::toCharArray) //
                        .toArray(char[][]::new);

        int col = INPUT.indexOf('|');
        StringBuilder sb = new StringBuilder();

        Direction direction = Direction.DOWN;
        System.out.println(input.length + " " + input[0].length);
        int stepCount = 1;
        loop: for (int row = 1; row < input.length; stepCount++) {
            char next = input[row][col];
            switch (next) {
                case '+':
                    if (direction.horizontal()) {
                        if (input[row - 1][col] != ' ') {
                            direction = Direction.UP;
                        } else {
                            direction = Direction.DOWN;
                        }
                    } else if (direction.vertical()) {
                        if (input[row][col - 1] != ' ') {
                            direction = Direction.LEFT;
                        } else {
                            direction = Direction.RIGHT;
                        }
                    }
                    break;
                case ' ':
                    break loop;
                case '|':
                case '-':
                    break;
                default:
                    sb.append(next);
            }
            switch (direction) {
                case UP:
                    row--;
                    break;
                case DOWN:
                    row++;
                    break;
                case LEFT:
                    col--;
                    break;
                case RIGHT:
                    col++;
                    break;
            }
        }

        System.out.println(sb.toString());
        System.out.println(stepCount);

        Instant after = Instant.now();
        System.out.println(Duration.between(before, after));
    }

}
